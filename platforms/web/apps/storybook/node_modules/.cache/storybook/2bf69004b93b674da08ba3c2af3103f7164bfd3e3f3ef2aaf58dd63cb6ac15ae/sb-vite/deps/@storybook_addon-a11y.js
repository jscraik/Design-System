import {
  __export
} from "./chunk-CO2NOYSF.js";
import {
  definePreviewAddon9,
  require_preview_api,
  require_preview_errors,
  require_test
} from "./chunk-BI5DTIJF.js";
import "./chunk-OO6TECMW.js";
import "./chunk-ZHUVNPXK.js";
import {
  require_global
} from "./chunk-ZPVR2N6U.js";
import {
  __toESM
} from "./chunk-PLDDJCW6.js";

// ../../../../node_modules/.pnpm/@storybook+addon-a11y@10.1.11_storybook@10.1.11_@testing-library+dom@10.4.0_prettier@3._b4e91c9a0bfae11987f980be06f53f21/node_modules/@storybook/addon-a11y/dist/_browser-chunks/chunk-3FKQRDK3.js
var ADDON_ID = "storybook/a11y";
var PANEL_ID = `${ADDON_ID}/panel`;
var PARAM_KEY = "a11y";
var UI_STATE_ID = `${ADDON_ID}/ui`;
var RESULT = `${ADDON_ID}/result`;
var REQUEST = `${ADDON_ID}/request`;
var RUNNING = `${ADDON_ID}/running`;
var ERROR = `${ADDON_ID}/error`;
var MANUAL = `${ADDON_ID}/manual`;
var SELECT = `${ADDON_ID}/select`;
var DOCUMENTATION_LINK = "writing-tests/accessibility-testing";
var DOCUMENTATION_DISCREPANCY_LINK = `${DOCUMENTATION_LINK}#why-are-my-tests-failing-in-different-environments`;
var EVENTS = { RESULT, REQUEST, RUNNING, ERROR, MANUAL, SELECT };

// ../../../../node_modules/.pnpm/@storybook+addon-a11y@10.1.11_storybook@10.1.11_@testing-library+dom@10.4.0_prettier@3._b4e91c9a0bfae11987f980be06f53f21/node_modules/@storybook/addon-a11y/dist/_browser-chunks/chunk-CQ2APV2R.js
var import_test = __toESM(require_test(), 1);
var import_preview_errors = __toESM(require_preview_errors(), 1);
var import_global = __toESM(require_global(), 1);
var import_preview_api = __toESM(require_preview_api(), 1);
var import_global2 = __toESM(require_global(), 1);
var preview_exports = {};
__export(preview_exports, {
  afterEach: () => afterEach,
  initialGlobals: () => initialGlobals,
  parameters: () => parameters
});
var { document } = import_global2.global;
var withLinkPaths = (results, storyId) => {
  let pathname = document.location.pathname.replace(/iframe\.html$/, ""), enhancedResults = { ...results };
  return ["incomplete", "passes", "violations"].forEach((key) => {
    Array.isArray(results[key]) && (enhancedResults[key] = results[key].map((result) => ({
      ...result,
      nodes: result.nodes.map((node, index) => {
        let id = `${key}.${result.id}.${index + 1}`, linkPath = `${pathname}?path=/story/${storyId}&addonPanel=${PANEL_ID}&a11ySelection=${id}`;
        return { id, ...node, linkPath };
      })
    })));
  }), enhancedResults;
};
var { document: document2 } = import_global.global;
var channel = import_preview_api.addons.getChannel();
var DEFAULT_PARAMETERS = { config: {}, options: {} };
var DISABLED_RULES = [
  // In component testing, landmarks are not always present
  // and the rule check can cause false positives
  "region"
];
var queue = [];
var isRunning = false;
var runNext = async () => {
  if (queue.length === 0) {
    isRunning = false;
    return;
  }
  isRunning = true;
  let next = queue.shift();
  next && await next(), runNext();
};
var run = async (input = DEFAULT_PARAMETERS, storyId) => {
  let axe = (await import("./axe-ZIWNSKVF.js"))?.default || globalThis.axe, { config = {}, options = {} } = input;
  if (input.element)
    throw new import_preview_errors.ElementA11yParameterError();
  let context = {
    include: document2?.body,
    exclude: [".sb-wrapper", "#storybook-docs", "#storybook-highlights-root"]
    // Internal Storybook elements that are always in the document
  };
  if (input.context) {
    let hasInclude = typeof input.context == "object" && "include" in input.context && input.context.include !== void 0, hasExclude = typeof input.context == "object" && "exclude" in input.context && input.context.exclude !== void 0;
    hasInclude ? context.include = input.context.include : !hasInclude && !hasExclude && (context.include = input.context), hasExclude && (context.exclude = context.exclude.concat(input.context.exclude));
  }
  axe.reset();
  let configWithDefault = {
    ...config,
    rules: [...DISABLED_RULES.map((id) => ({ id, enabled: false })), ...config?.rules ?? []]
  };
  return axe.configure(configWithDefault), new Promise((resolve, reject) => {
    let highlightsRoot = document2?.getElementById("storybook-highlights-root");
    highlightsRoot && (highlightsRoot.style.display = "none");
    let task = async () => {
      try {
        let result = await axe.run(context, options), resultWithLinks = withLinkPaths(result, storyId);
        resolve(resultWithLinks);
      } catch (error) {
        reject(error);
      }
    };
    queue.push(task), isRunning || runNext(), highlightsRoot && (highlightsRoot.style.display = "");
  });
};
channel.on(EVENTS.MANUAL, async (storyId, input = DEFAULT_PARAMETERS) => {
  try {
    await (0, import_preview_api.waitForAnimations)();
    let result = await run(input, storyId), resultJson = JSON.parse(JSON.stringify(result));
    channel.emit(EVENTS.RESULT, resultJson, storyId);
  } catch (error) {
    channel.emit(EVENTS.ERROR, error);
  }
});
function getIsVitestStandaloneRun() {
  try {
    return import.meta.env.VITEST_STORYBOOK === "false";
  } catch {
    return false;
  }
}
var vitestMatchersExtended = false;
var afterEach = async ({
  id: storyId,
  reporting,
  parameters: parameters2,
  globals,
  viewMode
}) => {
  let a11yParameter = parameters2.a11y, a11yGlobals = globals.a11y, shouldRunEnvironmentIndependent = a11yParameter?.disable !== true && a11yParameter?.test !== "off" && a11yGlobals?.manual !== true, getMode = () => {
    switch (a11yParameter?.test) {
      case "todo":
        return "warning";
      case "error":
      default:
        return "failed";
    }
  };
  if (shouldRunEnvironmentIndependent && viewMode === "story")
    try {
      let result = await run(a11yParameter, storyId);
      if (result) {
        let hasViolations = (result?.violations.length ?? 0) > 0;
        if (reporting.addReport({
          type: "a11y",
          version: 1,
          result,
          status: hasViolations ? getMode() : "passed"
        }), getIsVitestStandaloneRun() && hasViolations && getMode() === "failed") {
          if (!vitestMatchersExtended) {
            let { toHaveNoViolations } = await import("./matchers-DMFSMG2O-6XO3BU3E.js");
            import_test.expect.extend({ toHaveNoViolations }), vitestMatchersExtended = true;
          }
          (0, import_test.expect)(result).toHaveNoViolations();
        }
      }
    } catch (e) {
      if (reporting.addReport({
        type: "a11y",
        version: 1,
        result: {
          error: e
        },
        status: "failed"
      }), getIsVitestStandaloneRun())
        throw e;
    }
};
var initialGlobals = {
  a11y: {
    manual: false
  }
};
var parameters = {
  a11y: {
    test: "todo"
  }
};

// ../../../../node_modules/.pnpm/@storybook+addon-a11y@10.1.11_storybook@10.1.11_@testing-library+dom@10.4.0_prettier@3._b4e91c9a0bfae11987f980be06f53f21/node_modules/@storybook/addon-a11y/dist/index.js
var index_default = () => definePreviewAddon9(preview_exports);
export {
  PARAM_KEY,
  index_default as default
};
//# sourceMappingURL=@storybook_addon-a11y.js.map
